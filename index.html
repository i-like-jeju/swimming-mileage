<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>마일리지 기록판</title>
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<style>
body { font-family: system-ui; background:#f8fafc; padding:12px; }
.card, .team-card, .record-card { background:#fff; border-radius:14px; padding:14px; margin-bottom:16px; box-shadow:0 4px 12px rgba(0,0,0,.06); }
.weight-box { display:flex; gap:10px; margin:10px 0; }
.weight-box label { flex:1; background:#f1f5f9; padding:10px; border-radius:10px; text-align:center; }
.progress-bar { height:10px; background:#e5e7eb; border-radius:999px; overflow:hidden; }
.progress-fill { height:100%; background:linear-gradient(90deg,#3b82f6,#22c55e); }
</style>
</head>
<body>

<div class="card">
<h2>기록 추가</h2>
<select id="memberSelect"></select>
<label>수영 거리 (km)</label>
<input type="number" id="distance" step="0.1" />
<div class="weight-box">
<label><input type="checkbox" id="w3"> 3인수영 x1.1</label>
<label><input type="checkbox" id="wSea"> 바다수영 x2</label>
</div>
<p>가중치: <b id="wVal">x1</b><br>반영 마일리지: <b id="mVal">0</b> km</p>
<input type="file" id="proof" />
<button onclick="save()">저장</button>
</div>

<script>
const supabase = supabase.createClient("https://tsropshzbqrfladkgwsr.supabase.co","sb_publishable_13HduBGv5qjNmCusvyfkMw_fcV1V6Jm");
const distance = document.getElementById("distance");
const w3 = document.getElementById("w3");
const wSea = document.getElementById("wSea");

function calc(){
 let w=1;
 if(w3.checked) w*=1.1;
 if(wSea.checked) w*=2;
 document.getElementById("wVal").innerText="x"+w.toFixed(1);
 document.getElementById("mVal").innerText=(distance.value*w||0).toFixed(1);
}
distance.oninput=w3.onchange=wSea.onchange=calc;

async function save(){
 let w=1;
 if(w3.checked) w*=1.1;
 if(wSea.checked) w*=2;
 const weighted = distance.value*w;

 let proof_url=null;
 const f=document.getElementById("proof").files[0];
 if(f){
  const path=Date.now()+"_"+f.name;
  await supabase.storage.from("proofs").upload(path,f);
  proof_url=supabase.storage.from("proofs").getPublicUrl(path).data.publicUrl;
 }

 await supabase.from("records").insert({
  member_id: memberSelect.value,
  base_distance: distance.value,
  weight_3person: w3.checked,
  weight_sea: wSea.checked,
  weighted_mileage: weighted,
  proof_url
 });
 alert("저장됨");
}
</script>
</body>
</html>
